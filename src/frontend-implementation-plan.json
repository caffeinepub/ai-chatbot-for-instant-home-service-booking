{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Optional customer name in chat booking flow and UI display",
  "requirements": [
    {
      "id": "REQ-20",
      "summary": "Add an optional customer name prompt to the chat-based new-booking flow, allowing users to skip, and include it in the confirmation summary.",
      "acceptanceCriteria": [
        "During the 'new booking' flow, the bot prompts the user for their name with clear instructions that it is optional and can be skipped.",
        "If the user skips, the booking flow continues normally without a name.",
        "If the user provides a name, it is stored in the in-progress booking draft and included in the booking summary/confirmation step.",
        "All user-facing text added/updated for this feature is in English."
      ],
      "file_operations": [
        {
          "path": "frontend/src/chat/types.ts",
          "operation": "modify",
          "description": "Extend the chat booking draft/state types to include an optional customerName field and introduce a dedicated conversation step (e.g., 'customer-name') used only in the new-booking flow."
        },
        {
          "path": "frontend/src/chat/bookingStateMachine.ts",
          "operation": "modify",
          "description": "Update the new-booking state machine to prompt for an optional customer name (with a clear skip option), store it in the draft when provided, and proceed to the next step when skipped. Ensure all added bot messages are in English."
        },
        {
          "path": "frontend/src/screens/ChatBookingScreen.tsx",
          "operation": "modify",
          "description": "Update the booking confirmation/summary panel to display the provided customer name when present and omit the field entirely when skipped (no placeholder/empty label). Ensure the chat UI offers a clear skip path (e.g., quick reply 'Skip') as driven by the state machine. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/utils/chatPersistence.ts",
          "operation": "modify",
          "description": "Ensure persisted conversation state can load safely when the draft includes the new optional customerName field (and older saved drafts without it continue to load without errors)."
        }
      ]
    },
    {
      "id": "REQ-22",
      "summary": "Update frontend booking creation bindings to send the optional customer name to backend createBooking and keep TypeScript types consistent.",
      "acceptanceCriteria": [
        "When a booking is created from the chat flow, the frontend passes the optional customer name value (or null/empty when skipped) to the backend createBooking call.",
        "The app still successfully creates bookings when the name is omitted.",
        "TypeScript types remain consistent with the generated backend bindings (no type errors in the booking creation flow)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useCreateBooking.ts",
          "operation": "modify",
          "description": "Update the create booking mutation to accept an optional name and call actor.createBooking with the correct parameter order per backend bindings (name first), passing null when the user skips. Keep types aligned with frontend/src/backend.d.ts."
        },
        {
          "path": "frontend/src/screens/ChatBookingScreen.tsx",
          "operation": "modify",
          "description": "Wire the draft customerName into the createBooking mutation params so the optional name is sent when confirming a booking; pass null/omit when skipped while preserving successful booking creation."
        }
      ]
    },
    {
      "id": "REQ-23",
      "summary": "Display stored customer name in Booking Details and Admin Dashboard booking details with graceful fallback when missing.",
      "acceptanceCriteria": [
        "Booking Details screen shows the customer name if present on the booking; if not present, it does not show an empty/placeholder field.",
        "Admin Dashboard booking details sheet shows the customer name if present (prefer showing the bookingâ€™s stored name; fall back to user profile name if that is the existing pattern, then fall back to principal short form).",
        "UI does not break for existing bookings that have no stored name."
      ],
      "file_operations": [
        {
          "path": "frontend/src/screens/BookingDetailsScreen.tsx",
          "operation": "modify",
          "description": "Render a 'Customer Name' row/section only when booking.name is present/non-empty; ensure existing bookings without a name do not show an empty field and the layout remains stable. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/screens/AdminDashboardScreen.tsx",
          "operation": "modify",
          "description": "In the booking details sheet, display customer name with priority: booking.name (stored on the booking) -> customerProfile.name (existing pattern) -> principal short form. Hide the name line entirely if no meaningful value exists. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}