{
  "kind": "build_request",
  "title": "Add optional customer name field to booking flow and persist it with bookings",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-20",
      "text": "Add an optional customer name field to the chat-based booking flow so the bot asks for the customer’s name during new bookings and allows the user to skip it.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "CAN YOU ADD OPTION FOR NAME"
        ]
      },
      "acceptanceCriteria": [
        "During the 'new booking' flow, the bot prompts the user for their name with clear instructions that it is optional and can be skipped.",
        "If the user skips, the booking flow continues normally without a name.",
        "If the user provides a name, it is stored in the in-progress booking draft and included in the booking summary/confirmation step.",
        "All user-facing text added/updated for this feature is in English."
      ]
    },
    {
      "id": "REQ-21",
      "text": "Persist the optional customer name with each booking in the backend by extending the Booking data model and the createBooking API to accept and store an optional name.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "CAN YOU ADD OPTION FOR NAME"
        ]
      },
      "acceptanceCriteria": [
        "The backend Booking record includes a field to store an optional customer name.",
        "The createBooking method accepts an optional name parameter and stores it with the booking.",
        "Existing read APIs (getMyBookings, getBookingDetails, and admin-facing booking queries if present) return the customer name field as part of the booking data.",
        "If there are existing stored bookings, they continue to load successfully after the change, with customer name defaulting to null/empty for pre-existing records (use a state migration only if required by the current stable storage strategy)."
      ]
    },
    {
      "id": "REQ-22",
      "text": "Update frontend API bindings and booking mutations to send the optional customer name to the backend when creating a booking.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "CAN YOU ADD OPTION FOR NAME"
        ]
      },
      "acceptanceCriteria": [
        "When a booking is created from the chat flow, the frontend passes the optional customer name value (or null/empty when skipped) to the backend createBooking call.",
        "The app still successfully creates bookings when the name is omitted.",
        "TypeScript types remain consistent with the generated backend bindings (no type errors in the booking creation flow)."
      ]
    },
    {
      "id": "REQ-23",
      "text": "Display the stored customer name where booking details are shown in the UI (at minimum: Booking Details screen; Admin Dashboard booking details panel), with graceful fallback when the name is missing.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "CAN YOU ADD OPTION FOR NAME"
        ]
      },
      "acceptanceCriteria": [
        "Booking Details screen shows the customer name if present on the booking; if not present, it does not show an empty/placeholder field.",
        "Admin Dashboard booking details sheet shows the customer name if present (prefer showing the booking’s stored name; fall back to user profile name if that is the existing pattern, then fall back to principal short form).",
        "UI does not break for existing bookings that have no stored name."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single-actor Motoko canister (all logic in backend/main.mo).",
    "Do not edit files under frontend/src/components/ui (compose them only).",
    "Do not modify immutable frontend hook/bootstrap files listed in SYSTEM_CONTEXT.frontend.immutablePaths.",
    "Do not add SMS/email sending; external messaging is out of platform scope."
  ],
  "nonGoals": [
    "Implementing SMS or email booking confirmations.",
    "Adding third-party authentication providers (only Internet Identity is supported).",
    "Building advanced NLP/LLM-based name extraction from free text beyond the existing deterministic approach."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}